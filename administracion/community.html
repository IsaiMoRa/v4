<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="Isai Morales" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SISEC V3</title>
    <link rel="icon" type="image/png" href="../imagenes/favicon.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css"
    />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/sidenav.css" />
  </head>
  <body id="body-pd">
    <header class="header" id="header">
      <div class="container-fluid">
        <div id="componenteHeader"></div>
      </div>
    </header>
    <!--Componentes del header-->
    <div>
      <!--Prospectos-->
      <div id="componenteProspectos"></div>
      <!--Notificaciones-->
      <div id="componenteToast"></div>
      <!--Tareas-->
      <div id="componenteTareas"></div>
      <!--Ajustes-->
      <div id="componenteAjustes"></div>
    </div>

    <div class="l-navbar" id="nav-bar">
      <nav class="nav">
        <div>
          <a href="#" class="nav_logo">
            <img class="iconoLogo" src="../imagenes/iconoLogo.png" alt="" />
            <span class="nav_logo-name">
              <img
                class="logoSistema"
                src="../imagenes/logoSistema.png"
                alt=""
              />
            </span>
          </a>
          <!--Menu componente-->
          <div id="menu"></div>
          <!--Menu componente-->
        </div>
      </nav>
    </div>

    <!--Container Main start-->
    <div class="">
      <div class="row">
        <div class="col-md-12">
          <div class="contentTable">
            <!--Componente Agregra Ejecutivo / Community Manager-->
            <div class="btnAgregar">
              <button
                type="button"
                class="btn btn-primary botonAgregar"
                data-bs-toggle="modal"
                data-bs-target="#nuevoCM"
              >
                Nuevo Community Manager
              </button>
            </div>
            <!--Título de tabla de asesores-->
            <p class="tituloContent mb-3">
              Administración de asesores - community manager
            </p>

            <!-- Modal  Community-->
            <div
              class="modal fade"
              id="nuevoCM"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header headerAjustes">
                    <h1 class="modal-title modal-title-ejecutivo fs-5">
                      <strong> Tipo de usuario </strong>
                    </h1>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    >
                      <img src="../imagenes/iconoCerrar.png" alt="" />
                    </button>
                  </div>
                  <div class="modal-body">
                    <div
                      class="row row-cols-1 row-cols-md-2 g-3 formularioPerfil mt-2"
                      id="cardContainer"
                    >
                      <div class="col">
                        <div class="card cardAjustes" id="cardAgencia">
                          <div>
                            <img src="../imagenes/iconoAgencia.png" alt="" />
                          </div>
                          <p>Agencia Community Manager</p>
                        </div>
                      </div>
                      <div class="col">
                        <div class="card cardAjustes" id="carCM">
                          <div>
                            <img src="../imagenes/iconoCM.png" alt="" />
                          </div>
                          <p>Community Manager</p>
                        </div>
                      </div>
                    </div>

                    <!-- Contenido oculto inicialmente -->
                    <div class="contentAgencia" style="display: none">
                      <div
                        class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 formularioPerfil mt-2 contentBody"
                      >
                        <div class="colFull">
                          <p class="tituloContent">Datos de la agencia</p>
                        </div>
                        <div class="col">
                          <label class="form-label">Nombre(s)</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">RFC</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Teléfono</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Correo electrónico</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="clearfix"></div>
                        <div class="colFull">
                          <p class="tituloContent">Datos del agente</p>
                        </div>
                        <div class="col">
                          <label class="form-label">Nombre(s)</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">RFC</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Teléfono</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Correo electrónico</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="clearfix"></div>
                        <div class="colFull">
                          <p class="tituloContent">Documentos</p>
                        </div>
                        <div class="col">
                          <label class="form-label">INE</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label"
                            >Comprobante de domicilio</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="contentCM" style="display: none">
                      <div
                        class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 formularioPerfil mt-2 contentBody"
                      >
                        <div class="colFull">
                          <p class="tituloContent">
                            Datos del Community Manager
                          </p>
                        </div>
                        <div class="col">
                          <label class="form-label">Nombre(s)</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Primero apellido</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Segundo apellido</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">CURP</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Teléfono</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label">Correo electrónico</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="clearfix"></div>
                        <div class="colFull">
                          <p class="tituloContent">Documentos</p>
                        </div>
                        <div class="col">
                          <label class="form-label">INE</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                        <div class="col">
                          <label class="form-label"
                            >Comprobante de domicilio</label
                          ><input type="text" id="" class="form-control" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn cerrarModal"
                      data-bs-dismiss="modal"
                    >
                      Cancelar
                    </button>
                    <button
                      type="button"
                      class="btn botonAgregar"
                      id="btnAceptarTipoUsuario"
                      style="display: none"
                    >
                      Aceptar
                    </button>
                    <button
                      type="button"
                      class="btn botonGuardar botonAgregarFila"
                      id="btnGuardar"
                      style="display: none"
                    >
                      Enviar a jurídico
                    </button>
                  </div>
                </div>
              </div>
            </div>



            <div class="infoNone">
              <table
                id="tablaCM"
                class="display table table-bordered"
                style="width: 100%"
              >
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Ejecutivo Hipotecario</th>
                    <th>Perfil</th>
                    <th>Nombre de usuario</th>
                    <th>CURP</th>
                    <th>ID Ejecutivo</th>
                    <th>Sucursal</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--Container Main end-->
    <!--Footer-->
    <footer>
      <img src="../imagenes/footer.png" alt="" />
    </footer>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn-script.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/data/tareas.js"></script>
    

    <script>
      $(document).ready(function () {
        let filaEditando = null;

        const dataActivos = [
          [
            "00/00/00",
            "Prueba",
            "Perfil demo",
            "Usuario demo",
            "CURPDEMO001",
            "00001",
            "Sucursal demo",
            null,
          ],
          [
            "00/00/00",
            "Prueba",
            "Perfil demo",
            "Usuario demo",
            "CURPDEMO001",
            "00001",
            "Sucursal demo",
            null,
          ],
          [
            "00/00/00",
            "Prueba",
            "Perfil demo",
            "Usuario demo",
            "CURPDEMO001",
            "00001",
            "Sucursal demo",
            null,
          ],
          [
            "00/00/00",
            "Prueba",
            "Perfil demo",
            "Usuario demo",
            "CURPDEMO001",
            "00001",
            "Sucursal demo",
            null,
          ],
        ];

        const t = $("#tablaCM").DataTable({
          data: dataActivos,
          columns: [
            { title: "Fecha" },
            { title: "Ejecutivo Hipotecario" },
            { title: "Perfil" },
            { title: "Nombre de usuario" },
            { title: "CURP" },
            { title: "ID Ejecutivo" },
            { title: "Sucursal" },
            {
              title: "Acción",
              defaultContent: `
                <button class="btn-editar"><img src="../../imagenes/iconoEditar.png" alt="Editar" width="20" height="20" /></button>
                <button class="btn-eliminar"><img src="../../imagenes/iconoInhabilitar.png" alt="Editar" width="20" height="20" /></button>
              `,
              orderable: false,
            },
          ],
          language: {
            url: "https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",
          },
          autoWidth: false,
          scrollX: true,
          paging: true,
          searching: true,
          info: false,
        });

        // Botón para agregar fila
        $("#addRow").on("click", function () {
          const rowData = [
            $("#column1").val(),
            $("#column2").val(),
            $("#column3").val(),
            $("#column4").val(),
            $("#column5").val(),
            $("#column6").val(),
            $("#column7").val(),
            null,
          ];

          t.row.add(rowData).draw(false);
          limpiarFormulario();
        });

        // Evento para eliminar fila
        $("#tablaCM tbody").on("click", ".btn-eliminar", function () {
          const row = t.row($(this).parents("tr"));
          Swal.fire({
            title: "¿Estás seguro?",
            text: "Esta acción no se puede deshacer.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Sí, eliminar",
            cancelButtonText: "Cancelar",
          }).then((result) => {
            if (result.isConfirmed) {
              row.remove().draw();
              Swal.fire("¡Eliminado!", "La fila ha sido eliminada.", "success");
            }
          });
        });

        // Evento para editar fila
        $("#tablaCM tbody").on("click", ".btn-editar", function () {
          filaEditando = t.row($(this).parents("tr"));
          const data = filaEditando.data();

          // Llenar inputs
          $("#column1").val(data[0]);
          $("#column2").val(data[1]);
          $("#column3").val(data[2]);
          $("#column4").val(data[3]);
          $("#column5").val(data[4]);
          $("#column6").val(data[5]);
          $("#column7").val(data[6]);

          // Cambiar título
          $(".modal-title-ejecutivo").text("Editar Ejecutivo");

          // Mostrar modal
          const modal = new bootstrap.Modal(
            document.getElementById("staticBackdrop")
          );
          modal.show();

          // Botones
          $("#addRow").hide();
          $("#saveEdit").show();
        });

        // Guardar cambios de edición
        $("#saveEdit").on("click", function () {
          if (filaEditando) {
            const updatedData = [
              $("#column1").val(),
              $("#column2").val(),
              $("#column3").val(),
              $("#column4").val(),
              $("#column5").val(),
              $("#column6").val(),
              $("#column7").val(),
              null,
            ];

            filaEditando.data(updatedData).draw(false);
            filaEditando = null;

            limpiarFormulario();
            $("#addRow").show();
            $("#saveEdit").hide();

            Swal.fire({
              icon: "success",
              title: "Cambios guardados",
              showConfirmButton: false,
              timer: 1500,
            });
          }
        });

        // Limpiar al cerrar modal
        $("#staticBackdrop").on("hidden.bs.modal", function () {
          limpiarFormulario();
          filaEditando = null;
          $("#addRow").show();
          $("#saveEdit").hide();
          $(".modal-title-ejecutivo").text("Nuevo Ejecutivo");
        });

        // Función para limpiar el formulario
        function limpiarFormulario() {
          $(
            "#column1, #column2, #column3, #column4, #column5, #column6, #column7"
          ).val("");
        }
      });
    </script>

    <script>
      $(document).ready(function () {
        function activarCard(idCard, titulo) {
          $(".cardAjustes").removeClass("activeCard");
          $("#" + idCard).addClass("activeCard");
          $(".contentAgencia, .contentCM").fadeOut(300);
          $(".modal-title").html(`<strong>${titulo}</strong>`);
          $("#btnAceptarTipoUsuario").show();
          $("#btnGuardar").hide();
        }

        $("#cardAgencia").on("click", function () {
          activarCard("cardAgencia", "Agencia Community Manager");
        });

        $("#carCM").on("click", function () {
          activarCard("carCM", "Community Manager");
        });

        $("#btnAceptarTipoUsuario").on("click", function () {
          // Validación: si no se ha seleccionado ninguna tarjeta
          if (!$(".cardAjustes").hasClass("activeCard")) {
            Swal.fire({
              toast: true,
              icon: "warning",
              title: "Debes seleccionar un tipo de usuario",
              position: "top-end",
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true,
            });
            return; // Detener ejecución si no se seleccionó nada
          }

          $("#nuevoCM .modal-dialog")
            .removeClass("modal-lg")
            .animate({ width: "80%" }, 300)
            .addClass("modal-xl");

          $("#cardContainer").fadeOut(300);
          $(".contentAgencia, .contentCM").fadeOut(300);

          if ($("#cardAgencia").hasClass("activeCard")) {
            $(".contentAgencia").fadeIn(300);
          } else {
            $(".contentCM").fadeIn(300);
          }

          $(this).hide();
          $("#btnGuardar").show();
        });

        $("#btnGuardar").on("click", function () {
          Swal.fire({
            title: "¿Estás seguro?",
            text: "Se guardarán los cambios realizados.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Sí, guardar",
            cancelButtonText: "Cancelar",
            reverseButtons: true,
            customClass: {
              confirmButton: "btn btn-success",
              cancelButton: "btn btn-secondary",
            },
          }).then((result) => {
            if (result.isConfirmed) {
              Swal.fire({
                icon: "success",
                title: "¡Guardado correctamente!",
                text: "Los cambios se han guardado con éxito.",
                confirmButtonText: "Aceptar",
                customClass: {
                  confirmButton: "btn btn-primary",
                },
              });

              $("#nuevoCM").modal("hide");
            }
          });
        });

        $("#nuevoCM").on("show.bs.modal", function () {
          $(".cardAjustes").removeClass("activeCard");
          $(".contentAgencia, .contentCM").hide();
          $(".modal-title").html("<strong>Tipo de usuario</strong>");
          $("#btnAceptarTipoUsuario").show();
          $("#btnGuardar").hide();
          $("#cardContainer").fadeIn(300);
          $("#nuevoCM .modal-dialog")
            .removeClass("modal-xl")
            .animate({ width: "60%" }, 300)
            .addClass("modal-lg");
        });
      });
    </script>
  </body>
</html>
